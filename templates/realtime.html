{% extends "base.html" %}

{% block title %}Detección en Tiempo Real{% endblock %}

{% block page_title %}{{ titulo if titulo else "Panel de Control - Tiempo Real" }}{% endblock %}

{% block page_description %}
    {{ descripcion if descripcion else "Bienvenido al sistema inteligente de análisis con IA y Big Data." }}
{% endblock %}

{% block content %}

{# Cabecera específica de esta página, usando variables del contexto #}
<div class="page-header mb-4"> {# mb-4 es un margen inferior de ejemplo #}
    <h1 class="page-title">{{ titulo if titulo else "Panel de Control Principal" }}</h1>
    <p class="page-description">
        {{ descripcion if descripcion else "Bienvenido al sistema inteligente de análisis con IA y Big Data. Explora las diferentes funcionalidades disponibles en las pestañas superiores." }}
    </p>
</div>

<h2>Detección en Tiempo Real - Cámara: {{ camara if camara else "Ninguna seleccionada" }}</h2>

<form method="get" action="{{ url_for('realtime_page') }}"> {# Asegúrate que la acción es la ruta correcta #}
    <label for="camara">Selecciona Cámara:</label>
    <select name="camara" id="camara">
        <option value="">-- Selecciona una cámara --</option>
        {% for c in camaras_disponibles %} {# Cambiado a camaras_disponibles para evitar conflicto con la variable 'camara' seleccionada #}
            <option value="{{ c }}" {% if c == camara %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
    </select>
    <button type="submit">Ver</button>
</form>

{% if datos_deteccion %} {# Cambiado a datos_deteccion para claridad #}
    {% if datos_deteccion.error %}
        <p style="color: red;">Error: {{ datos_deteccion.error }}</p>
    {% elif datos_deteccion.message %} {# Para mensajes como "selecciona una cámara" #}
        <p>{{ datos_deteccion.message }}</p>
    {% else %}
        <h3>Vehículos detectados: {{ datos_deteccion.vehicle_count }}</h3>
        <p>Resolución: {{ datos_deteccion.resolution }}</p>
        <p>FPS procesamiento: {{ datos_deteccion.processing_fps }}</p>
        <img src="{{ datos_deteccion.image }}" alt="Imagen anotada" width="600" style="max-width: 100%; height: auto; border: 1px solid #ddd; margin-top: 10px;">
    {% endif %}
{% endif %}


{% endblock %}